module.exports=function(e){function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){"use strict";var n=t(1);r.FileStorage=n["default"];var i=t(8);r.RedisStorage=i["default"];var o=function(){function e(e,r){this.storageConfig=e,this.cacheRules=r}return e.prototype.url=function(e){switch(this.storageConfig.type){case"file":return new n["default"](e,this.storageConfig,this.cacheRules);case"redis":return new i["default"](e,this.storageConfig,this.cacheRules);default:throw new Error("Unknown Storage config type value. Only file|redis allowed")}},e}();r.CacheEngine=o},function(e,r,t){"use strict";var n=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},i=t(2),o=t(3),c=t(4),u=t(5),l=t(6),s=t(7),a=s("simple-url-cache-FS");l.polyfill();var h=function(e){function r(r,t,n){var i=this;e.call(this,r,n),this._url=r,this._storageConfig=t,this._regexRules=n,this.escape=function(){var e=i._url.replace(":","%3A");return e=e.replace(".","%2E"),e=e.replace("~","%7E"),e=encodeURIComponent(e)},this.validate=function(e){return 0!==e.length&&(!(e.length>255)&&"undefined"!=typeof e)},this.isCached=function(){return new Promise(function(e,r){if(c.existsSync(i._currentFilePath)){if("maxAge"===i._currentCategory){var t=c.statSync(i._currentFilePath),n=(new Date).getTime(),o=t.mtime.getTime(),u=o+1e3*i._currentMaxAge,l=n-u;i.diff=l,l>0?(i.removeUrl(),a("This url is expired.... removing the cache. ",i._url),e(!1)):(a("This url is cached.",i._url),e(!0))}a("This url is cached ",i._url),e(!0)}else a("This url is not cached ",i._url),e(!1)})},this.removeUrl=function(){return a("removing url cache: ",i._url),new Promise(function(e,r){try{c.unlinkSync(i._currentFilePath),e(!0)}catch(t){a("Error while removing url: ",i._url,t),r(!1)}})},this.getUrl=function(){return a("Retrieving url cache: ",i._url),new Promise(function(e,r){i.isCached().then(function(t){t?e(c.readFileSync(i._currentFilePath,"utf8")):r("This url is not cached: "+i._url)})})},this.cache=function(e,r){return a("Caching url ",i._url),new Promise(function(t,n){return i._validFile?r===!0?void c.writeFile(i._currentFilePath,e,"utf8",function(e){e?(a("Error while writing cache.",i._url,e),n("invalid URL")):(a("URL cached sucessfully: ",i._url),t(!0))}):void i.isCached().then(function(r){if(r)t(!1);else{if("never"===i._currentCategory)return a("Won't cache the url - category is never.",i._url),void t(!1);c.writeFile(i._currentFilePath,e,"utf8",function(e){e?(a("Error while writing cache.",i._url,e),n("invalid URL")):(a("URL cached sucessfully: ",i._url),t(!0))})}}):(a("FILE -> invalid REJECTED",i._url),void n("invalid URL"))})},this.destroy=function(){},u.mkdir("-p",this._storageConfig.dir);var l=this.escape();this._validFile=this.validate(l),this._currentFilePath=o.join(this._storageConfig.dir,l),a("FileStorage instanciated with url: "+this._url),a("_currentFilePath = ",this._currentFilePath)}return n(r,e),r}(i.CacheCategory);Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=h},function(e,r){"use strict";var t=function(){function e(e,r){var t=this;this.currentUrl=e,this._config=r,this.getRegexTest=function(e){return e.regex.test(t.currentUrl)},this.getCacheCategory=function(){var e;for(e in t._config.cacheNever)if(t.getRegexTest(t._config.cacheNever[e])===!0)return void(t._currentCategory="never");for(e in t._config.cacheAlways)if(t.getRegexTest(t._config.cacheAlways[e])===!0)return void(t._currentCategory="always");for(e in t._config.cacheMaxAge)if(t.getRegexTest(t._config.cacheMaxAge[e])===!0)return t._currentCategory="maxAge",void(t._currentMaxAge=t._config.cacheMaxAge[e].maxAge);t._currentCategory=t._config["default"]},this.getCacheCategory()}return e.prototype.getCategory=function(){return this._currentCategory},e.prototype.getCurrentUrl=function(){return this.currentUrl},e}();r.CacheCategory=t},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("fs")},function(e,r){e.exports=require("shelljs")},function(e,r){e.exports=require("es6-promise")},function(e,r){e.exports=require("debug")},function(e,r,t){"use strict";var n=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},i=t(2),o=t(6),c=t(7),u=t(9);o.polyfill();var l=c("simple-url-cache-REDIS"),s=function(e){function r(r,t,n){var i=this;e.call(this,r,n),this._url=r,this._storageConfig=t,this._regexRules=n,this.isRedisOnline=function(){return u.RedisPool.isOnline()},this.isCached=function(){return new Promise(function(e,r){i._conn.get(i._url,function(t,n){if(t)l("Error while querying is cached on redis: ",i._url,t),r(t);else{var o=null!==n;e(o)}})})},this.removeUrl=function(){return l("removing url cache: ",i._url),new Promise(function(e,r){i._conn.del(i._url,function(t,n){t&&(l("Error while removing url: ",i._url,t),r(t)),e(!0)})})},this.getUrl=function(){return l("Retrieving url cache: ",i._url),new Promise(function(e,r){i._conn.get(i._url,function(t,n){t&&(l("Error while retrieving url: ",i._url,t),r(t)),null===n?(l("This url is not cached - and can't be retrieved: ",i._url),r("This url is not cached: "+i._url)):e(n)})})},this.cache=function(e,r){return l("Caching url ",i._url),new Promise(function(t,n){r===!0?i._conn.set(i._url,e,function(e,r){e&&(l("Error while storing url in redis: ",i._url,e),n(e)),"maxAge"===i._currentCategory?i._conn.expire(i._url,i._currentMaxAge,function(e){e?(l("Error while setting ttl in redis: ",i._url,e),n(e)):(l("URL cached successfully with ttl = ",i._currentMaxAge,i._url),t(!0))}):(l("URL cached sucessfully: ",i._url),t(!0))}):i.isCached().then(function(r){r===!0?(l("This url is already cached - not storing it: ",i._url),t(!1)):"never"===i._currentCategory?(l("Won't cache the url - category is never.",i._url),t(!1)):i._conn.set(i._url,e,function(e,r){e&&(l("Error while storing url in redis: ",i._url,e),n(e)),"maxAge"===i._currentCategory?i._conn.expire(i._url,i._currentMaxAge,function(e){e?(l("Error while setting ttl in redis: ",i._url,e),n(e)):(l("URL cached successfully with ttl = ",i._currentMaxAge,i._url),t(!0))}):(l("URL cached sucessfully: ",i._url),t(!0))})})})},this.destroy=function(){u.RedisPool.kill()},this._conn=u.RedisPool.connect(this._storageConfig)}return n(r,e),r._redisPool=u.RedisPool,r}(i.CacheCategory);Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=s},function(e,r,t){"use strict";var n,i=t(10),o=t(7),c=o("simple-url-cache-REDIS"),u=null;!function(e){var r=!1;e.connect=function(e){return null===u&&(c("This redis connection has never been instanciated before"),u=i.createClient(e),u.on("connect",function(){r=!0,console.log("redis connected")}),u.on("error",function(e){throw console.error(e),r=!0,u=null,new Error(e)}),u.on("end",function(){u=null,r=!1,console.error("Connection closed")}),u.on("warning",function(e){console.error("Warning called: ",e)})),u},e.isOnline=function(){return null!==u&&r===!0},e.kill=function(){r===!0&&u.end()}}(n=r.RedisPool||(r.RedisPool={}))},function(e,r){e.exports=require("redis")}]);
//# sourceMappingURL=simple-cache.min.js.map