{"version":3,"sources":["webpack:///webpack/bootstrap 705997f621ff612498f5","webpack:///./ts/cacheEngine.ts","webpack:///./ts/fileStorage.ts","webpack:///./ts/abstract.ts","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"shelljs\"","webpack:///external \"es6-promise\"","webpack:///external \"debug\"","webpack:///./ts/redisStorage.ts","webpack:///./ts/redisPool.ts","webpack:///external \"redis\""],"names":[],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACtCA,yCAAwB,CAAe,CAAC;AACxC,0CAAyB,CAAgB,CAAC;AAI1C,OAAM,CAAC,OAAO,GAAG;KAEb,qBAAqB,aAA4B,EAAU,UAAsB;SAA5D,kBAAa,GAAb,aAAa,CAAe;SAAU,eAAU,GAAV,UAAU,CAAY;KAAG,CAAC;KAErF,yBAAG,GAAH,UAAI,GAAW;SACX,MAAM,EAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;aAC7B,KAAK,MAAM;iBACP,MAAM,CAAC,IAAI,qBAAW,CAAC,GAAG,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;aACrE,KAAK,OAAO;iBACR,MAAM,CAAC,IAAI,sBAAY,CAAC,GAAG,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;aACtE;iBACI,MAAM,IAAI,KAAK,CAAC,4DAA4D,CAAC,CAAC;SACtF,CAAC;KACL,CAAC;KACL,kBAAC;AAAD,EAAC;;;;;;;;;;;;;ACnBD,sCAA4B,CAAY,CAAC;AAEzC,KAAY,IAAI,uBAAM,CAAM,CAAC;AAC7B,KAAY,EAAE,uBAAM,CAAI,CAAC;AACzB,KAAY,KAAK,uBAAM,CAAS,CAAC;AACjC,yCAAuB,CAAa,CAAC;AACrC,KAAY,IAAI,uBAAM,CAAO,CAAC;AAC9B,KAAI,KAAK,GAAG,IAAI,CAAC,qBAAqB,CAAC,CAAC;AAExC,uBAAQ,EAAE,CAAC;AAEX;KAAyC,+BAAa;KAKlD,qBAAqB,IAAY,EAAU,cAAiC,EAAU,WAAuB;SALjH,iBAmIC;SA7HO,kBAAO,IAAI,EAAE,WAAW,CAAC,CAAC;SADT,SAAI,GAAJ,IAAI,CAAQ;SAAU,mBAAc,GAAd,cAAc,CAAmB;SAAU,gBAAW,GAAX,WAAW,CAAY;SAUrG,WAAM,GAAG;aACb,IAAI,OAAO,GAAG,KAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;aAC5C,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,4EAA4E;aACnH,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,iDAAiD;aACxF,OAAO,GAAG,kBAAkB,CAAC,OAAO,CAAC,CAAC;aACtC,MAAM,CAAC,OAAO,CAAC;SACnB,CAAC,CAAC;SAEM,aAAQ,GAAG,UAAC,GAAG;aACnB,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;iBAAC,MAAM,CAAC,KAAK,CAAC;aAAA,CAAC;aACtC,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC;iBAAC,MAAM,CAAC,KAAK,CAAC;aAAA,CAAC;aACtC,EAAE,CAAC,CAAC,OAAO,GAAG,KAAK,WAAW,CAAC,CAAC,CAAC;iBAAC,MAAM,CAAC,KAAK,CAAC;aAAC,CAAC;aACjD,MAAM,CAAC,IAAI,CAAC;SAChB,CAAC,CAAC;SAEF,aAAQ,GAAG;aACP,MAAM,CAAC,IAAI,OAAO,CAAE,UAAC,OAAO,EAAE,MAAM;iBAChC,EAAE,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,KAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;qBACvC,EAAE,CAAC,CAAC,KAAI,CAAC,gBAAgB,KAAK,QAAQ,CAAC,CAAC,CAAC;yBACrC,IAAI,KAAK,GAAG,EAAE,CAAC,QAAQ,CAAC,KAAI,CAAC,gBAAgB,CAAC,CAAC;yBAC/C,IAAI,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;yBACxC,IAAI,gBAAgB,GAAG,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;yBAC7C,IAAI,UAAU,GAAG,gBAAgB,GAAG,KAAI,CAAC,cAAc,GAAG,IAAI,CAAC;yBAC/D,IAAI,IAAI,GAAG,CAAC,YAAY,GAAG,UAAU,CAAC,CAAC;yBACvC,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;yBACjB,EAAE,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;6BACX,oDAAoD;6BACpD,KAAI,CAAC,SAAS,EAAE,CAAC;6BACjB,KAAK,CAAC,8CAA8C,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;6BACjE,OAAO,CAAC,KAAK,CAAC,CAAC;yBACnB,CAAC;yBAAC,IAAI,CAAC,CAAC;6BACJ,KAAK,CAAC,qBAAqB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;6BACxC,OAAO,CAAC,IAAI,CAAC,CAAC;yBAClB,CAAC;qBACL,CAAC;qBACD,KAAK,CAAC,qBAAqB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qBACxC,OAAO,CAAC,IAAI,CAAC,CAAC;iBAClB,CAAC;iBAAC,IAAI,CAAC,CAAC;qBACJ,KAAK,CAAC,yBAAyB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qBAC5C,OAAO,CAAC,KAAK,CAAC,CAAC;iBACnB,CAAC;aACL,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAEF,cAAS,GAAG;aACR,KAAK,CAAC,sBAAsB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aACzC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,IAAI,CAAC;qBACD,EAAE,CAAC,UAAU,CAAE,KAAI,CAAC,gBAAgB,CAAE,CAAC;qBACvC,OAAO,CAAC,IAAI,CAAC,CAAC;iBAClB,CAAE;iBAAA,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;qBACT,KAAK,CAAC,4BAA4B,EAAE,KAAI,CAAC,IAAI,EAAG,CAAC,CAAC,CAAC;qBACnD,MAAM,CAAC,KAAK,CAAC,CAAC;iBAClB,CAAC;aACL,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAEF,WAAM,GAAG;aACL,KAAK,CAAC,wBAAwB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aAC3C,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,KAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;qBAC1B,EAAE,EAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;yBACX,MAAM,CAAC,0BAA0B,GAAG,KAAI,CAAC,IAAI,CAAC,CAAC;qBACnD,CAAC;qBAAC,IAAI,EAAC;yBACH,OAAO,CAAE,EAAE,CAAC,YAAY,CAAC,KAAI,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAE,CAAC;qBAC9D,CAAC;iBACL,CAAC,CAAC,CAAC;aACP,CAAC,CAAC,CAAC;SACP,CAAC;SAED,UAAK,GAAG,UAAC,IAAW,EAAE,KAAe;aAEjC,KAAK,CAAC,cAAc,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aACjC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,EAAE,CAAC,CAAC,CAAC,KAAI,CAAC,UAAW,CAAC,CAAC,CAAC;qBACpB,KAAK,CAAC,UAAU,GAAG,kBAAkB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qBAClD,MAAM,CAAC,aAAa,CAAC,CAAC;qBACtB,MAAM,CAAC;iBACX,CAAC;iBACD,IAAI,CAAC,CAAC;qBACF,EAAE,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC;yBACjB,EAAE,CAAC,SAAS,CAAE,KAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE,MAAM,EAAG,UAAC,GAAG;6BACpD,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;iCACN,KAAK,CAAC,4BAA4B,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;iCACpD,MAAM,CAAC,aAAa,CAAC,CAAC;6BAC1B,CAAC;6BAAC,IAAI,CAAC,CAAC;iCACJ,KAAK,CAAC,0BAA0B,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;iCAC7C,OAAO,CAAC,IAAI,CAAC,CAAC;6BAClB,CAAC;yBACL,CAAC,CAAC,CAAC;yBACH,MAAM,CAAC;qBACX,CAAC;qBAED,KAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;yBAC1B,EAAE,EAAC,QAAQ,CAAC,CAAC,CAAC;6BACV,OAAO,CAAC,KAAK,CAAC,CAAC;yBACnB,CAAC;yBAAC,IAAI,EAAC;6BACH,EAAE,CAAC,CAAC,KAAI,CAAC,gBAAgB,KAAK,OAAO,CAAC,CAAC,CAAC;iCACpC,KAAK,CAAC,2CAA2C,EAAE,KAAI,CAAC,IAAI,CAAC;iCAC7D,OAAO,CAAC,KAAK,CAAC,CAAC;iCACf,MAAM,CAAC;6BACX,CAAC;6BACD,EAAE,CAAC,SAAS,CAAE,KAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE,MAAM,EAAE,UAAC,GAAG;iCACnD,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;qCACN,KAAK,CAAC,4BAA4B,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;qCACpD,MAAM,CAAC,aAAa,CAAC,CAAC;iCAC1B,CAAC;iCAAC,IAAI,CAAC,CAAC;qCACJ,KAAK,CAAC,0BAA0B,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qCAC7C,OAAO,CAAC,IAAI,CAAC,CAAC;iCAClB,CAAC;6BACL,CAAC,CAAE,CAAC;yBACR,CAAC;qBACL,CAAC,CAAC,CAAC;iBACP,CAAC;aACL,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SA3HE,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;SAC3C,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;SAC5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;SACzC,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,OAAO,CAAE,CAAC;SACtE,KAAK,CAAC,qCAAqC,GAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACxD,KAAK,CAAC,qBAAqB,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;KACxD,CAAC;KAsHL,kBAAC;AAAD,EAAC,CAnIwC,wBAAa,GAmIrD;AAnID;8BAmIC;;;;;;;;AC3ID;KAKI,uBAAsB,UAAkB,EAAY,OAAmB;SAL3E,iBAiDC;SA5CyB,eAAU,GAAV,UAAU,CAAQ;SAAY,YAAO,GAAP,OAAO,CAAY;SAI/D,iBAAY,GAAG,UAAC,CAAY;aAChC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,KAAI,CAAC,UAAU,CAAC,CAAC;SACzC,CAAC,CAAC;SAEF,8CAA8C;SACtC,qBAAgB,GAAG;aACvB,IAAI,CAAC,CAAC;aACN,GAAG,CAAC,CAAC,CAAC,IAAI,KAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC;iBAChC,EAAE,CAAC,CAAC,KAAI,CAAC,YAAY,CAAE,KAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC;qBAC1D,KAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC;qBAChC,MAAM,CAAC;iBACX,CAAC;aACL,CAAC;aAED,GAAG,CAAC,CAAC,CAAC,IAAI,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;iBACjC,EAAE,CAAC,CAAC,KAAI,CAAC,YAAY,CAAE,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC;qBAC3D,KAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;qBACjC,MAAM,CAAC,IAAI,CAAC;iBAChB,CAAC;aACL,CAAC;aAED,GAAG,CAAC,CAAC,CAAC,IAAI,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;iBACjC,EAAE,CAAC,CAAC,KAAI,CAAC,YAAY,CAAE,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC;qBAC3D,KAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;qBACjC,KAAI,CAAC,cAAc,GAAG,KAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;qBACzD,MAAM,CAAC,IAAI,CAAC;iBAChB,CAAC;aACL,CAAC;aAED,KAAI,CAAC,gBAAgB,GAAG,KAAI,CAAC,OAAO,CAAC,OAAO,CAAC;SACjD,CAAC,CAAC;SAjCE,IAAI,CAAC,gBAAgB,EAAE,CAAC;KAC5B,CAAC;KAkCM,mCAAW,GAAlB;SACI,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC;KACjC,CAAC;KAEM,qCAAa,GAApB;SACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;KAC3B,CAAC;KAEL,oBAAC;AAAD,EAAC;AAjDqB,sBAAa,gBAiDlC;;;;;;;ACpDD,kC;;;;;;ACAA,gC;;;;;;ACAA,qC;;;;;;ACAA,yC;;;;;;ACAA,mC;;;;;;;;;;;;ACAA,sCAA4B,CAAY,CAAC;AAEzC,uCAA+B,CAAa,CAAC;AAC7C,yCAAuB,CAAa,CAAC;AACrC,KAAY,IAAI,uBAAM,CAAO,CAAC;AAE9B,uBAAQ,EAAE,CAAC;AACX,KAAI,KAAK,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC;AAE3C;KAA0C,gCAAa;KAKnD,sBAAqB,IAAY,EAAU,cAAkC,EAAU,WAAuB;SALlH,iBAiIC;SA3HO,kBAAM,IAAI,EAAE,WAAW,CAAC,CAAC;SADR,SAAI,GAAJ,IAAI,CAAQ;SAAU,mBAAc,GAAd,cAAc,CAAoB;SAAU,gBAAW,GAAX,WAAW,CAAY;SAU9G,kBAAa,GAAG;aACZ,MAAM,CAAC,KAAI,CAAC,YAAY,CAAC;SAC7B,CAAC,CAAC;SAEF,aAAQ,GAAG;aACP,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAChC,KAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,EAAE,UAAC,GAAG,EAAE,IAAI;qBAC3C,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;yBACN,KAAK,CAAC,2CAA2C,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;yBACnE,MAAM,CAAC,GAAG,CAAC,CAAC;qBAChB,CAAC;qBAAC,IAAI,CAAC,CAAC;yBACJ,IAAI,QAAQ,GAAG,IAAI,KAAK,IAAI,CAAC;yBAC7B,OAAO,CAAC,QAAQ,CAAC,CAAC;qBACtB,CAAC;iBAEL,CAAC,CAAC,CAAC;aACN,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAEF,cAAS,GAAG;aACR,KAAK,CAAC,sBAAsB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aACzC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,KAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,EAAE,UAAC,GAAG,EAAE,IAAI;qBAC3C,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;yBACN,KAAK,CAAC,4BAA4B,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;yBACpD,MAAM,CAAC,GAAG,CAAC,CAAC;qBAChB,CAAC;qBACD,OAAO,CAAC,IAAI,CAAC,CAAC;iBAClB,CAAC,CAAC,CAAC;aACP,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAEF,WAAM,GAAG;aACL,KAAK,CAAC,wBAAwB,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aAC3C,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,KAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,EAAE,UAAC,GAAG,EAAE,IAAI;qBAC3C,EAAE,EAAC,GAAG,CAAC,CAAC,CAAC;yBACL,KAAK,CAAC,8BAA8B,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;yBACtD,MAAM,CAAC,GAAG,CAAC,CAAC;qBAChB,CAAC;qBACD,EAAE,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC;yBAChB,KAAK,CAAC,oDAAoD,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;yBACvE,MAAM,CAAC,0BAA0B,GAAG,KAAI,CAAC,IAAI,CAAC,CAAC;qBACnD,CAAC;qBAAC,IAAI,CAAC,CAAC;yBACJ,OAAO,CAAC,IAAI,CAAC,CAAC;qBAClB,CAAC;iBACL,CAAC,CAAC,CAAC;aACP,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAEF,UAAK,GAAG,UAAC,IAAY,EAAE,KAAe;aAClC,KAAK,CAAC,cAAc,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;aACjC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;iBAC/B,EAAE,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC;qBACjB,KAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,EAAE,IAAI,EAAE,UAAC,GAAG,EAAE,MAAM;yBACnD,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;6BACN,KAAK,CAAC,oCAAoC,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;6BAC5D,MAAM,CAAC,GAAG,CAAC,CAAC;yBAChB,CAAC;yBACD,EAAE,EAAE,KAAI,CAAC,gBAAgB,KAAK,QAAQ,CAAC,CAAC,CAAC;6BACrC,KAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,KAAI,CAAC,IAAI,EAAE,KAAI,CAAC,cAAc,EAAE,UAAC,GAAG;iCAC9D,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;qCACN,KAAK,CAAC,oCAAoC,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;qCAC5D,MAAM,CAAC,GAAG,CAAC,CAAC;iCAChB,CAAC;iCACD,IAAI,CAAC,CAAC;qCACF,KAAK,CAAC,qCAAqC,EAAE,KAAI,CAAC,cAAc,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qCAC7E,OAAO,CAAC,IAAI,CAAC,CAAC;iCAClB,CAAC;6BACL,CAAC,CAAC,CAAC;yBACP,CAAC;yBAAC,IAAI,CAAC,CAAC;6BACJ,KAAK,CAAC,0BAA0B,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;6BAC7C,OAAO,CAAC,IAAI,CAAC,CAAC;yBAClB,CAAC;qBAEL,CAAC,CAAC,CAAC;iBACP,CAAC;iBACD,IAAI,EAAC;qBACD,KAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ;yBAC1B,EAAE,EAAC,QAAQ,KAAK,IAAI,CAAC,CAAC,CAAC;6BACnB,KAAK,CAAC,+CAA+C,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;6BAClE,OAAO,CAAC,KAAK,CAAC,CAAC;yBACnB,CAAC;yBACD,IAAI,CAAC,EAAE,CAAC,CAAC,KAAI,CAAC,gBAAgB,KAAK,OAAO,CAAC,CAAC,CAAC;6BACzC,KAAK,CAAC,2CAA2C,EAAE,KAAI,CAAC,IAAI,CAAC;6BAC7D,OAAO,CAAC,KAAK,CAAC,CAAC;yBACnB,CAAC;yBACD,IAAI,EAAC;6BACD,KAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,KAAI,CAAC,IAAI,EAAE,IAAI,EAAE,UAAC,GAAG,EAAE,MAAM;iCACnD,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;qCACN,KAAK,CAAC,oCAAoC,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;qCAAgC,MAAM,CAAC,GAAG,CAAC,CAAC;iCAC5G,CAAC;iCACD,EAAE,EAAE,KAAI,CAAC,gBAAgB,KAAK,QAAQ,CAAC,CAAC,CAAC;qCACrC,KAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,KAAI,CAAC,IAAI,EAAE,KAAI,CAAC,cAAc,EAAE,UAAC,GAAG;yCAC7D,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;6CACN,KAAK,CAAC,oCAAoC,EAAE,KAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;6CAC5D,MAAM,CAAC,GAAG,CAAC,CAAC;yCAChB,CAAC;yCACD,IAAI,CAAC,CAAC;6CACF,KAAK,CAAC,qCAAqC,EAAE,KAAI,CAAC,cAAc,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;6CAC7E,OAAO,CAAC,IAAI,CAAC,CAAC;yCAClB,CAAC;qCACL,CAAC,CAAC,CAAC;iCACP,CAAC;iCAAC,IAAI,CAAC,CAAC;qCACJ,KAAK,CAAC,0BAA0B,EAAE,KAAI,CAAC,IAAI,CAAC,CAAC;qCAC7C,OAAO,CAAC,IAAI,CAAC,CAAC;iCAClB,CAAC;6BAEL,CAAC,CAAC,CAAC;yBACP,CAAC;qBACL,CAAC,CAAC,CAAC;iBACP,CAAC;aACL,CAAC,CAAC,CAAC;SACP,CAAC,CAAC;SAzHE,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;SAC1B,IAAI,CAAC,gBAAgB,GAAG,4BAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;SACvE,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,SAAS,EAAE;aAChC,KAAI,CAAC,YAAY,GAAG,IAAI,CAAC;aACzB,KAAK,CAAC,iBAAiB,CAAC,CAAC;SAC7B,CAAC,CAAC,CAAC;KACP,CAAC;KAoHL,mBAAC;AAAD,EAAC,CAjIyC,wBAAa,GAiItD;AAjID;+BAiIC;;;;;;;;AC1ID,KAAa,KAAK,uBAAM,EAAO,CAAC;AAGhC,KAAI,GAAG,GAAG,EAAE,CAAC,CAAC,oCAAoC;AAElD,KAAM,cAAc,GAAG,UAAC,MAAW;KAC/B,IAAI,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;KAC3C,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAE5B,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC;SACpB,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;SACjB,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;KACvB,CAAC,CAAC,CAAC;KACH,MAAM,CAAC,SAAS,CAAC;AACrB,EAAC,CAAC;AAEW,yBAAgB,GAAE,UAAC,IAAI,EAAE,MAAM;KACxC,IAAI,GAAG,IAAI,IAAI,SAAS,CAAC,CAAC,sCAAsC;KAEhE,EAAE,EAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,EAAC;SACnC,GAAG,CAAC,IAAI,CAAC,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC;KACvC,CAAC;KACD,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACrB,EAAC,CAAC;AAEW,aAAI,GAAG,UAAC,IAAI;KACrB,IAAI,GAAG,IAAI,IAAI,SAAS,CAAC,CAAC,0CAA0C;KACpE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,CAAC;KAChB,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC;AACrB,EAAC,CAAC;AAEW,gBAAO,GAAG;KACnB,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KAC5B,IAAI,CAAC,OAAO,CAAC,UAAS,CAAC;SACnB,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;SACb,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC;KAClB,CAAC,CAAC;AACN,EAAC,CAAC;;;;;;;ACrCF,mC","file":"dist/simple-cache.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 705997f621ff612498f5\n **/","import FileStorage from './fileStorage';\nimport RedisStorage from './redisStorage';\n\nimport {StorageConfig, CacheRules} from './interfaces';\n\nmodule.exports = class CacheEngine {\n\n    constructor( private storageConfig: StorageConfig, private cacheRules: CacheRules) {}\n\n    url(url: string) {\n        switch(this.storageConfig.type) {\n            case 'file':\n                return new FileStorage(url, this.storageConfig, this.cacheRules);\n            case 'redis':\n                return new RedisStorage(url, this.storageConfig, this.cacheRules);\n            default:\n                throw new Error('Unknown Storage config type value. Only file|redis allowed');\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./ts/cacheEngine.ts\n **/","import {CacheCategory} from './abstract';\nimport {FileStorageConfig, CacheRules, CacheStorage} from './interfaces';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport * as shell from 'shelljs';\nimport {polyfill} from 'es6-promise';\nimport * as dbug from 'debug';\nlet debug = dbug('simple-url-cache-FS');\n\npolyfill();\n\nexport default class FileStorage extends CacheCategory implements CacheStorage{\n\n    private _currentFilePath: string;\n    public diff: number;\n    private _validFile: boolean;\n    constructor( private _url: string, private _storageConfig: FileStorageConfig, private _regexRules: CacheRules) {\n        super( _url, _regexRules);\n        shell.mkdir('-p', this._storageConfig.dir);\n        let escaped = this.escape();\n        this._validFile = this.validate(escaped);\n        this._currentFilePath = path.join( this._storageConfig.dir, escaped );\n        debug('FileStorage instanciated with url: '+ this._url);\n        debug('_currentFilePath = ', this._currentFilePath);\n    }\n\n    private escape = (): string => {\n        let escaped = this._url.replace(':', '%3A');\n        escaped = escaped.replace('.', '%2E'); //http://stackoverflow.com/questions/3856693/a-url-resource-that-is-a-dot-2e\n        escaped = escaped.replace('~', '%7E'); //http://www.w3schools.com/tags/ref_urlencode.asp\n        escaped = encodeURIComponent(escaped);\n        return escaped;\n    };\n\n    private validate = (str): boolean => {\n        if (str.length === 0) { return false;}\n        if (str.length > 255) { return false;}\n        if (typeof str === 'undefined') { return false; }\n        return true;\n    };\n\n    isCached = (): Promise<boolean> => {\n        return new Promise( (resolve, reject) => {\n            if (fs.existsSync(this._currentFilePath)) {\n                if (this._currentCategory === 'maxAge') {\n                    var stats = fs.statSync(this._currentFilePath);\n                    var nowTimestamp = new Date().getTime();\n                    var modificationTime = stats.mtime.getTime();\n                    var expiration = modificationTime + this._currentMaxAge * 1000;\n                    var diff = (nowTimestamp - expiration);\n                    this.diff = diff;\n                    if (diff > 0) {\n                        //the file is expired, remove it, then return false;\n                        this.removeUrl();\n                        debug('This url is expired.... removing the cache. ', this._url);\n                        resolve(false);\n                    } else {\n                        debug('This url is cached.', this._url);\n                        resolve(true);\n                    }\n                }\n                debug('This url is cached ', this._url);\n                resolve(true);\n            } else {\n                debug('This url is not cached ', this._url);\n                resolve(false);\n            }\n        });\n    };\n\n    removeUrl = (): Promise<boolean> => {\n        debug('removing url cache: ', this._url);\n        return new Promise((resolve, reject) => {\n            try {\n                fs.unlinkSync( this._currentFilePath );\n                resolve(true);\n            } catch (e) {\n                debug('Error while removing url: ', this._url , e);\n                reject(false);\n            }\n        });\n    };\n\n    getUrl = (): Promise<string> => {\n        debug('Retrieving url cache: ', this._url);\n        return new Promise((resolve, reject) => {\n            this.isCached().then((isCached) => {\n                if(!isCached) {\n                    reject('This url is not cached: ' + this._url);\n                } else{\n                    resolve( fs.readFileSync(this._currentFilePath, 'utf8') );\n                }\n            });\n        });\n    }\n\n    cache = (html:string, force?: boolean): Promise<boolean> => {\n\n        debug('Caching url ', this._url);\n        return new Promise((resolve, reject) => {\n            if (!this._validFile ) {\n                debug('FILE -> ' + 'invalid REJECTED', this._url);\n                reject('invalid URL');\n                return;\n            }\n            else {\n                if (force === true) {\n                    fs.writeFile( this._currentFilePath, html, 'utf8' , (err) => {\n                        if (err) {\n                            debug('Error while writing cache.', this._url, err);\n                            reject('invalid URL');\n                        } else {\n                            debug('URL cached sucessfully: ', this._url);\n                            resolve(true);\n                        }\n                    });\n                    return;\n                }\n\n                this.isCached().then((isCached) => {\n                    if(isCached) {\n                        resolve(false);\n                    } else{\n                        if (this._currentCategory === 'never') {\n                            debug('Won\\'t cache the url - category is never.', this._url)\n                            resolve(false);\n                            return;\n                        }\n                        fs.writeFile( this._currentFilePath, html, 'utf8', (err) => {\n                            if (err) {\n                                debug('Error while writing cache.', this._url, err);\n                                reject('invalid URL');\n                            } else {\n                                debug('URL cached sucessfully: ', this._url);\n                                resolve(true);\n                            }\n                        } );\n                    }\n                });\n            }\n        });\n    };\n}\n\n\n/** WEBPACK FOOTER **\n ** ./ts/fileStorage.ts\n **/","import {CacheRules, RegexRule} from './interfaces';\n\n\nexport abstract class CacheCategory {\n\n    protected _currentCategory:string;\n    protected _currentMaxAge:number;\n\n    constructor(protected currentUrl: string, protected _config: CacheRules) {\n        this.getCacheCategory();\n    }\n\n    private getRegexTest = (u: RegexRule) => {\n        return u.regex.test(this.currentUrl);\n    };\n\n    //return always|never|maxAge|timestamp|default\n    private getCacheCategory = () => {\n        var i;\n        for (i in this._config.cacheNever) {\n            if (this.getRegexTest (this._config.cacheNever[i]) === true) {\n                this._currentCategory = 'never';\n                return;\n            }\n        }\n\n        for (i in this._config.cacheAlways) {\n            if (this.getRegexTest (this._config.cacheAlways[i]) === true) {\n                this._currentCategory = 'always';\n                return true;\n            }\n        }\n\n        for (i in this._config.cacheMaxAge) {\n            if (this.getRegexTest (this._config.cacheMaxAge[i]) === true) {\n                this._currentCategory = 'maxAge';\n                this._currentMaxAge = this._config.cacheMaxAge[i].maxAge;\n                return true;\n            }\n        }\n\n        this._currentCategory = this._config.default;\n    };\n\n    public getCategory() {\n        return this._currentCategory;\n    }\n\n    public getCurrentUrl() {\n        return this.currentUrl;\n    }\n\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./ts/abstract.ts\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"shelljs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"shelljs\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"es6-promise\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"es6-promise\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"debug\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"debug\"\n ** module id = 7\n ** module chunks = 0\n **/","import {CacheCategory} from './abstract';\nimport {RedisStorageConfig, CacheRules, CacheStorage} from './interfaces';\nimport {redis_connection} from './redisPool';\nimport {polyfill} from 'es6-promise';\nimport * as dbug from 'debug';\n\npolyfill();\nlet debug = dbug('simple-url-cache-REDIS');\n\nexport default class RedisStorage extends CacheCategory implements CacheStorage{\n\n    private _redisConnection: any;\n    private _redisOnline: boolean;\n\n    constructor( private _url: string, private _storageConfig: RedisStorageConfig, private _regexRules: CacheRules) {\n        super(_url, _regexRules);\n        this._redisOnline = false;\n        this._redisConnection = redis_connection('CACHE', this._storageConfig);\n        this._redisConnection.on('connect', () => {\n            this._redisOnline = true;\n            debug('REDIS CONNECTED');\n        });\n    }\n\n    isRedisOnline = (): boolean => {\n        return this._redisOnline;\n    };\n\n    isCached = ():Promise<boolean> => {\n        return new Promise((resolve, reject) =>{\n           this._redisConnection.get(this._url, (err, data) => {\n               if (err) {\n                   debug('Error while querying is cached on redis: ', this._url, err);\n                   reject(err);\n               } else {\n                   let isCached = data !== null;\n                   resolve(isCached);\n               }\n\n           });\n        });\n    };\n\n    removeUrl = (): Promise<boolean> => {\n        debug('removing url cache: ', this._url);\n        return new Promise((resolve, reject) =>{\n            this._redisConnection.del(this._url, (err, data) => {\n                if (err) {\n                    debug('Error while removing url: ', this._url, err);\n                    reject(err);\n                }\n                resolve(true);\n            });\n        });\n    };\n\n    getUrl = (): Promise<string> => {\n        debug('Retrieving url cache: ', this._url);\n        return new Promise((resolve, reject) =>{\n            this._redisConnection.get(this._url, (err, data) => {\n                if(err) {\n                    debug('Error while retrieving url: ', this._url, err);\n                    reject(err);\n                }\n                if (data === null) {\n                    debug('This url is not cached - and can\\'t be retrieved: ', this._url);\n                    reject('This url is not cached: ' + this._url);\n                } else {\n                    resolve(data);\n                }\n            });\n        });\n    };\n\n    cache = (html: string, force?: boolean): Promise<boolean> => {\n        debug('Caching url ', this._url);\n        return new Promise((resolve, reject) =>{\n            if (force === true) {\n                this._redisConnection.set(this._url, html, (err, result) => {\n                    if (err) {\n                        debug('Error while storing url in redis: ', this._url, err);\n                        reject(err);\n                    }\n                    if( this._currentCategory === 'maxAge') {\n                        this._redisConnection.expires(this._url, this._currentMaxAge, (err) =>{\n                            if (err) {\n                                debug('Error while setting ttl in redis: ', this._url, err);\n                                reject(err);\n                            }\n                            else {\n                                debug('URL cached successfully with ttl = ', this._currentMaxAge, this._url);\n                                resolve(true);\n                            }\n                        });\n                    } else {\n                        debug('URL cached sucessfully: ', this._url);\n                        resolve(true);\n                    }\n\n                });\n            }\n            else{\n                this.isCached().then((isCached) =>{\n                    if(isCached === true) {\n                        debug('This url is already cached - not storing it: ', this._url);\n                        resolve(false);\n                    }\n                    else if (this._currentCategory === 'never') {\n                        debug('Won\\'t cache the url - category is never.', this._url)\n                        resolve(false);\n                    }\n                    else{\n                        this._redisConnection.set(this._url, html, (err, result) => {\n                            if (err) {\n                                debug('Error while storing url in redis: ', this._url, err);                                reject(err);\n                            }\n                            if( this._currentCategory === 'maxAge') {\n                                this._redisConnection.expire(this._url, this._currentMaxAge, (err) => {\n                                    if (err) {\n                                        debug('Error while setting ttl in redis: ', this._url, err);\n                                        reject(err);\n                                    }\n                                    else {\n                                        debug('URL cached successfully with ttl = ', this._currentMaxAge, this._url);\n                                        resolve(true);\n                                    }\n                                });\n                            } else {\n                                debug('URL cached sucessfully: ', this._url);\n                                resolve(true);\n                            }\n\n                        });\n                    }\n                });\n            }\n        });\n    };\n}\n\n\n/** WEBPACK FOOTER **\n ** ./ts/redisStorage.ts\n **/","import * as  redis from 'redis';\n\n\nlet CON = {}; // store redis connections as Object\n\nconst new_connection = (config: any) => {\n    var redis_con = redis.createClient(config);\n    redis_con.auth(config.auth);\n\n    redis_con.on('error', (e) => {\n        console.error(e);\n        throw new Error(e);\n    });\n    return redis_con;\n};\n\nexport const redis_connection= (type, config) => {\n    type = type || 'DEFAULT'; // allow infinite types of connections\n\n    if(!CON[type] || !CON[type].connected){\n        CON[type] = new_connection(config);\n    }\n    return CON[type];\n};\n\nexport const kill = (type) => {\n    type = type || 'DEFAULT'; // kill specific connection or default one\n    CON[type].end();\n    delete CON[type];\n};\n\nexport const killall = () => {\n    var keys = Object.keys(CON);\n    keys.forEach(function(k){\n        CON[k].end();\n        delete CON[k];\n    })\n};\n\n\n/** WEBPACK FOOTER **\n ** ./ts/redisPool.ts\n **/","module.exports = require(\"redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redis\"\n ** module id = 10\n ** module chunks = 0\n **/"],"sourceRoot":""}