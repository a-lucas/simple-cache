{"version":3,"sources":["webpack:///webpack/bootstrap b2b72919d39e39c9dcd9","webpack:///./ts/index.ts","webpack:///./ts/fileStorage.ts","webpack:///./ts/abstract.ts","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"shelljs\"","webpack:///external \"es6-promise\"","webpack:///./ts/redisStorage.ts","webpack:///./ts/redisPool.ts","webpack:///external \"redis\""],"names":[],"mappings":"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","file":"dist/simple-cache.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap b2b72919d39e39c9dcd9\n **/","import FileStorage from './fileStorage';\nimport RedisStorage from './redisStorage';\n\nimport {StorageConfig, CacheRules} from './interfaces';\n\nclass CacheEngine {\n\n    constructor( private storageConfig: any, private cacheRules: CacheRules) {}\n\n    url(url: string) {\n        switch(this.storageConfig.type) {\n            case 'file':\n                return new FileStorage(url, this.storageConfig, this.cacheRules);\n            case 'redis':\n                return new RedisStorage(url, this.storageConfig, this.cacheRules);\n            default:\n                throw new Error('Unknown Storage config type value. Only file|redis allowed');\n        }\n    }\n}\n\nmodule.exports = CacheEngine;\n\n\n\n/** WEBPACK FOOTER **\n ** ./ts/index.ts\n **/","import {CacheCategory} from './abstract';\nimport {FileStorageConfig, CacheRules, CacheStorage} from './interfaces';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport * as shell from 'shelljs';\nimport {polyfill} from 'es6-promise';\npolyfill();\n\nexport default class FileStorage extends CacheCategory implements CacheStorage{\n\n    private _currentFilePath: string;\n    public diff: number;\n    constructor( private _url: string, private _storageConfig: FileStorageConfig, private _regexRules: CacheRules) {\n        super( _url, _regexRules);\n        shell.mkdir('-p', this._storageConfig.dir);\n        this._currentFilePath = path.join( this._storageConfig.dir, this._url );\n    }\n\n    isCached = () => {\n        return new Promise( (resolve, reject) => {\n            if (fs.existsSync(this._currentFilePath)) {\n                if (this._currentCategory === 'maxAge') {\n                    var stats = fs.statSync(this._currentFilePath);\n                    var nowTimestamp = new Date().getTime();\n                    var modificationTime = stats.mtime.getTime();\n                    var expiration = modificationTime + this._currentMaxAge * 1000;\n                    var diff = (nowTimestamp - expiration);\n                    this.diff = diff;\n                    if (diff > 0) {\n                        //the file is expired, remove it, then return false;\n                        this.removeUrl();\n                        resolve(false);\n                    } else {\n                        resolve(true);\n                    }\n                }\n                resolve(true);\n            } else {\n                resolve(false);\n            }\n        });\n    };\n\n    removeUrl = () => {\n        return new Promise((resolve, reject) => {\n            try {\n                fs.unlinkSync( this._currentFilePath );\n                resolve(true);\n            } catch (e) {\n                reject(false);\n            }\n        });\n    };\n\n    getUrl() {\n        return new Promise((resolve, reject) => {\n            this.isCached().then((isCached) => {\n                if(!isCached) {\n                    reject('This url is not cached: ' + this._url);\n                } else{\n                    resolve( fs.readFileSync(this._currentFilePath, 'utf8') );\n                }\n            });\n        });\n    }\n\n    cache = (html, force) => {\n\n        return new Promise((resolve, reject) => {\n            if (force === true) {\n                fs.writeFile( this._currentFilePath, html, 'utf8' , function(err) {\n                    if (err) {\n                        reject(err);\n                    } else {\n                        resolve(true);\n                    }\n                });\n                return;\n            }\n\n            this.isCached().then((isCached) => {\n                if(isCached) {\n                    resolve(false);\n                } else{\n                    if (this._currentCategory === 'never') {\n                        resolve(false);\n                        return;\n                    }\n                    fs.writeFile( this._currentFilePath, html, 'utf8', function(err) {\n                        if (err) {\n                            reject(err);\n                        } else {\n                            resolve(true);\n                        }\n                    } );\n                }\n            });\n\n\n        });\n    };\n}\n\n\n/** WEBPACK FOOTER **\n ** ./ts/fileStorage.ts\n **/","import {CacheRules, RegexRule} from './interfaces';\n\n\nexport abstract class CacheCategory {\n\n    protected _currentCategory:string;\n    protected _currentMaxAge:number;\n\n    constructor(protected currentUrl: string, protected _config: CacheRules) {\n        this.getCacheCategory();\n    }\n\n    private getRegexTest = (u: RegexRule) => {\n        return u.regex.test(this.currentUrl);\n    };\n\n    //return always|never|maxAge|timestamp|default\n    private getCacheCategory = () => {\n        var i;\n        for (i in this._config.cacheNever) {\n            if (this.getRegexTest (this._config.cacheNever[i]) === true) {\n                this._currentCategory = 'never';\n                return;\n            }\n        }\n\n        for (i in this._config.cacheAlways) {\n            if (this.getRegexTest (this._config.cacheAlways[i]) === true) {\n                this._currentCategory = 'always';\n                return true;\n            }\n        }\n\n        for (i in this._config.cacheMaxAge) {\n            if (this.getRegexTest (this._config.cacheMaxAge[i]) === true) {\n                this._currentCategory = 'maxAge';\n                this._currentMaxAge = this._config.cacheMaxAge[i].maxAge;\n                return true;\n            }\n        }\n\n        this._currentCategory = this._config.default;\n    };\n\n    public getCategory() {\n        return this._currentCategory;\n    }\n\n    public getCurrentUrl() {\n        return this.currentUrl;\n    }\n\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./ts/abstract.ts\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"shelljs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"shelljs\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"es6-promise\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"es6-promise\"\n ** module id = 6\n ** module chunks = 0\n **/","import {CacheCategory} from './abstract';\nimport {RedisStorageConfig, CacheRules, CacheStorage} from './interfaces';\nimport {redis_connection} from './redisPool';\nimport {polyfill} from 'es6-promise';\npolyfill();\n\nexport default class RedisStorage extends CacheCategory implements CacheStorage{\n\n    private _redisConnection: any;\n    private _redisOnline: boolean;\n\n    constructor( private _url: string, private _storageConfig: RedisStorageConfig, private _regexRules: CacheRules) {\n        super(_url, _regexRules);\n        this._redisOnline = false;\n        this._redisConnection = redis_connection('CACHE', this._storageConfig);\n        this._redisConnection.on('connect', () => {\n            this._redisOnline = true;\n            console.log('REDIS CONNECTED');\n        });\n        console.log('RedisStorage called ONCE');\n\n    }\n\n    isRedisOnline = () => {\n        return this._redisOnline;\n    };\n\n    isCached = () => {\n        return new Promise((resolve, reject) =>{\n           this._redisConnection.get(this._url, (err, data) => {\n               if (err) {\n                   console.error(err);\n                   reject(err);\n               } else {\n                   let isCached = data !== null;\n                   resolve(isCached);\n               }\n\n           });\n        });\n    };\n\n    removeUrl = () => {\n        return new Promise((resolve, reject) =>{\n            this._redisConnection.del(this._url, (err, data) => {\n                if (err) {\n                    console.error(err);\n                    reject(err);\n                }\n                resolve(true);\n            });\n        });\n    };\n\n    getUrl = () => {\n        return new Promise((resolve, reject) =>{\n            this._redisConnection.get(this._url, (err, data) => {\n                if(err) {\n                    console.error(err);\n                    reject(err);\n                }\n                if (data === null) {\n                    reject('This url is not cached: ' + this._url);\n                } else {\n                    resolve(data);\n                }\n            });\n        });\n    };\n\n    cache = (html, force) => {\n        return new Promise((resolve, reject) =>{\n            if (force === true) {\n                this._redisConnection.set(this._url, html, (err, result) => {\n                    if (err) {\n                        console.error(err);\n                        reject(err);\n                    }\n                    if( this._currentCategory === 'maxAge') {\n                        this._redisConnection.expires(this._url, this._currentMaxAge, function(err) {\n                            if (err) {\n                                console.error(err);\n                                reject(err);\n                            }\n                            else {\n                                resolve(true);\n                            }\n                        });\n                    } else {\n                        resolve(true);\n                    }\n\n                });\n            }\n            else{\n                this.isCached().then((isCached) =>{\n                    if(isCached === true) {\n                        resolve(false);\n                    }\n                    else if (this._currentCategory === 'never') {\n                        resolve(false);\n                    }\n                    else{\n                        this._redisConnection.set(this._url, html, (err, result) => {\n                            if (err) {\n                                console.error(err);\n                                reject(err);\n                            }\n                            if( this._currentCategory === 'maxAge') {\n                                this._redisConnection.expire(this._url, this._currentMaxAge, function(err) {\n                                    if (err) {\n                                        console.error(err);\n                                        reject(err);\n                                    }\n                                    else {\n                                        resolve(true);\n                                    }\n                                });\n                            } else {\n                                resolve(true);\n                            }\n\n                        });\n                    }\n                });\n            }\n        });\n    };\n}\n\n\n/** WEBPACK FOOTER **\n ** ./ts/redisStorage.ts\n **/","import * as  redis from 'redis';\n\n\nlet CON = {}; // store redis connections as Object\n\nconst new_connection = (config: any) => {\n    var redis_con = redis.createClient(config);\n    redis_con.auth(config.auth);\n\n    redis_con.on('error', (e) => {\n        console.error(e);\n        throw new Error(e);\n    });\n    return redis_con;\n};\n\nexport const redis_connection= (type, config) => {\n    type = type || 'DEFAULT'; // allow infinite types of connections\n\n    if(!CON[type] || !CON[type].connected){\n        CON[type] = new_connection(config);\n    }\n    return CON[type];\n};\n\nexport const kill = (type) => {\n    type = type || 'DEFAULT'; // kill specific connection or default one\n    CON[type].end();\n    delete CON[type];\n};\n\nexport const killall = () => {\n    var keys = Object.keys(CON);\n    keys.forEach(function(k){\n        CON[k].end();\n        delete CON[k];\n    })\n};\n\n\n/** WEBPACK FOOTER **\n ** ./ts/redisPool.ts\n **/","module.exports = require(\"redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redis\"\n ** module id = 9\n ** module chunks = 0\n **/"],"sourceRoot":""}