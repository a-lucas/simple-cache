{"version":3,"sources":["webpack:///dist/simple-cache.min.js","webpack:///webpack/bootstrap 007dcb7c1d1ffbbe14a0","webpack:///./ts/cacheEngine.ts","webpack:///./ts/fileStorage.ts","webpack:///./ts/abstract.ts","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"shelljs\"","webpack:///external \"es6-promise\"","webpack:///external \"debug\"","webpack:///./ts/redisStorage.ts","webpack:///./ts/redisPool.ts","webpack:///external \"redis\""],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","fileStorage_1","FileStorage","redisStorage_1","RedisStorage","CacheEngine","storageConfig","cacheRules","this","prototype","url","type","Error","__extends","d","b","__","constructor","hasOwnProperty","Object","create","abstract_1","path","fs","shell","es6_promise_1","dbug","debug","polyfill","_super","_url","_storageConfig","_regexRules","_this","escape","escaped","replace","encodeURIComponent","validate","str","length","isCached","Promise","resolve","reject","existsSync","_currentFilePath","_currentCategory","stats","statSync","nowTimestamp","Date","getTime","modificationTime","mtime","expiration","_currentMaxAge","diff","removeUrl","unlinkSync","e","getUrl","then","readFileSync","cache","html","force","_validFile","writeFile","err","destroy","mkdir","dir","join","CacheCategory","defineProperty","value","currentUrl","_config","getRegexTest","u","regex","test","getCacheCategory","i","cacheNever","cacheAlways","cacheMaxAge","maxAge","getCategory","getCurrentUrl","require","redisPool_1","isRedisOnline","RedisPool","isOnline","_conn","get","data","del","set","result","expire","kill","connect","_redisPool","redis","pool","_isOnline","config","createClient","on","console","log","error","msg","end"],"mappings":"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","file":"dist/simple-cache.min.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar fileStorage_1 = __webpack_require__(1);\n\texports.FileStorage = fileStorage_1.default;\n\tvar redisStorage_1 = __webpack_require__(8);\n\texports.RedisStorage = redisStorage_1.default;\n\tvar CacheEngine = (function () {\n\t    function CacheEngine(storageConfig, cacheRules) {\n\t        this.storageConfig = storageConfig;\n\t        this.cacheRules = cacheRules;\n\t    }\n\t    CacheEngine.prototype.url = function (url) {\n\t        switch (this.storageConfig.type) {\n\t            case 'file':\n\t                return new fileStorage_1.default(url, this.storageConfig, this.cacheRules);\n\t            case 'redis':\n\t                return new redisStorage_1.default(url, this.storageConfig, this.cacheRules);\n\t            default:\n\t                throw new Error('Unknown Storage config type value. Only file|redis allowed');\n\t        }\n\t    };\n\t    return CacheEngine;\n\t}());\n\texports.CacheEngine = CacheEngine;\n\t;\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar __extends = (this && this.__extends) || function (d, b) {\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n\t    function __() { this.constructor = d; }\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n\t};\n\tvar abstract_1 = __webpack_require__(2);\n\tvar path = __webpack_require__(3);\n\tvar fs = __webpack_require__(4);\n\tvar shell = __webpack_require__(5);\n\tvar es6_promise_1 = __webpack_require__(6);\n\tvar dbug = __webpack_require__(7);\n\tvar debug = dbug('simple-url-cache-FS');\n\tes6_promise_1.polyfill();\n\tvar FileStorage = (function (_super) {\n\t    __extends(FileStorage, _super);\n\t    function FileStorage(_url, _storageConfig, _regexRules) {\n\t        var _this = this;\n\t        _super.call(this, _url, _regexRules);\n\t        this._url = _url;\n\t        this._storageConfig = _storageConfig;\n\t        this._regexRules = _regexRules;\n\t        this.escape = function () {\n\t            var escaped = _this._url.replace(':', '%3A');\n\t            escaped = escaped.replace('.', '%2E'); //http://stackoverflow.com/questions/3856693/a-url-resource-that-is-a-dot-2e\n\t            escaped = escaped.replace('~', '%7E'); //http://www.w3schools.com/tags/ref_urlencode.asp\n\t            escaped = encodeURIComponent(escaped);\n\t            return escaped;\n\t        };\n\t        this.validate = function (str) {\n\t            if (str.length === 0) {\n\t                return false;\n\t            }\n\t            if (str.length > 255) {\n\t                return false;\n\t            }\n\t            if (typeof str === 'undefined') {\n\t                return false;\n\t            }\n\t            return true;\n\t        };\n\t        this.isCached = function () {\n\t            return new Promise(function (resolve, reject) {\n\t                if (fs.existsSync(_this._currentFilePath)) {\n\t                    if (_this._currentCategory === 'maxAge') {\n\t                        var stats = fs.statSync(_this._currentFilePath);\n\t                        var nowTimestamp = new Date().getTime();\n\t                        var modificationTime = stats.mtime.getTime();\n\t                        var expiration = modificationTime + _this._currentMaxAge * 1000;\n\t                        var diff = (nowTimestamp - expiration);\n\t                        _this.diff = diff;\n\t                        if (diff > 0) {\n\t                            //the file is expired, remove it, then return false;\n\t                            _this.removeUrl();\n\t                            debug('This url is expired.... removing the cache. ', _this._url);\n\t                            resolve(false);\n\t                        }\n\t                        else {\n\t                            debug('This url is cached.', _this._url);\n\t                            resolve(true);\n\t                        }\n\t                    }\n\t                    debug('This url is cached ', _this._url);\n\t                    resolve(true);\n\t                }\n\t                else {\n\t                    debug('This url is not cached ', _this._url);\n\t                    resolve(false);\n\t                }\n\t            });\n\t        };\n\t        this.removeUrl = function () {\n\t            debug('removing url cache: ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                try {\n\t                    fs.unlinkSync(_this._currentFilePath);\n\t                    resolve(true);\n\t                }\n\t                catch (e) {\n\t                    debug('Error while removing url: ', _this._url, e);\n\t                    reject(false);\n\t                }\n\t            });\n\t        };\n\t        this.getUrl = function () {\n\t            debug('Retrieving url cache: ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                _this.isCached().then(function (isCached) {\n\t                    if (!isCached) {\n\t                        reject('This url is not cached: ' + _this._url);\n\t                    }\n\t                    else {\n\t                        resolve(fs.readFileSync(_this._currentFilePath, 'utf8'));\n\t                    }\n\t                });\n\t            });\n\t        };\n\t        this.cache = function (html, force) {\n\t            debug('Caching url ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                if (!_this._validFile) {\n\t                    debug('FILE -> ' + 'invalid REJECTED', _this._url);\n\t                    reject('invalid URL');\n\t                    return;\n\t                }\n\t                else {\n\t                    if (force === true) {\n\t                        fs.writeFile(_this._currentFilePath, html, 'utf8', function (err) {\n\t                            if (err) {\n\t                                debug('Error while writing cache.', _this._url, err);\n\t                                reject('invalid URL');\n\t                            }\n\t                            else {\n\t                                debug('URL cached sucessfully: ', _this._url);\n\t                                resolve(true);\n\t                            }\n\t                        });\n\t                        return;\n\t                    }\n\t                    _this.isCached().then(function (isCached) {\n\t                        if (isCached) {\n\t                            resolve(false);\n\t                        }\n\t                        else {\n\t                            if (_this._currentCategory === 'never') {\n\t                                debug('Won\\'t cache the url - category is never.', _this._url);\n\t                                resolve(false);\n\t                                return;\n\t                            }\n\t                            fs.writeFile(_this._currentFilePath, html, 'utf8', function (err) {\n\t                                if (err) {\n\t                                    debug('Error while writing cache.', _this._url, err);\n\t                                    reject('invalid URL');\n\t                                }\n\t                                else {\n\t                                    debug('URL cached sucessfully: ', _this._url);\n\t                                    resolve(true);\n\t                                }\n\t                            });\n\t                        }\n\t                    });\n\t                }\n\t            });\n\t        };\n\t        this.destroy = function () { };\n\t        shell.mkdir('-p', this._storageConfig.dir);\n\t        var escaped = this.escape();\n\t        this._validFile = this.validate(escaped);\n\t        this._currentFilePath = path.join(this._storageConfig.dir, escaped);\n\t        debug('FileStorage instanciated with url: ' + this._url);\n\t        debug('_currentFilePath = ', this._currentFilePath);\n\t    }\n\t    return FileStorage;\n\t}(abstract_1.CacheCategory));\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = FileStorage;\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\tvar CacheCategory = (function () {\n\t    function CacheCategory(currentUrl, _config) {\n\t        var _this = this;\n\t        this.currentUrl = currentUrl;\n\t        this._config = _config;\n\t        this.getRegexTest = function (u) {\n\t            return u.regex.test(_this.currentUrl);\n\t        };\n\t        //return always|never|maxAge|timestamp|default\n\t        this.getCacheCategory = function () {\n\t            var i;\n\t            for (i in _this._config.cacheNever) {\n\t                if (_this.getRegexTest(_this._config.cacheNever[i]) === true) {\n\t                    _this._currentCategory = 'never';\n\t                    return;\n\t                }\n\t            }\n\t            for (i in _this._config.cacheAlways) {\n\t                if (_this.getRegexTest(_this._config.cacheAlways[i]) === true) {\n\t                    _this._currentCategory = 'always';\n\t                    return;\n\t                }\n\t            }\n\t            for (i in _this._config.cacheMaxAge) {\n\t                if (_this.getRegexTest(_this._config.cacheMaxAge[i]) === true) {\n\t                    _this._currentCategory = 'maxAge';\n\t                    _this._currentMaxAge = _this._config.cacheMaxAge[i].maxAge;\n\t                    return;\n\t                }\n\t            }\n\t            _this._currentCategory = _this._config.default;\n\t            return;\n\t        };\n\t        this.getCacheCategory();\n\t    }\n\t    CacheCategory.prototype.getCategory = function () {\n\t        return this._currentCategory;\n\t    };\n\t    CacheCategory.prototype.getCurrentUrl = function () {\n\t        return this.currentUrl;\n\t    };\n\t    return CacheCategory;\n\t}());\n\texports.CacheCategory = CacheCategory;\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"path\");\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"shelljs\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"es6-promise\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"debug\");\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar __extends = (this && this.__extends) || function (d, b) {\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n\t    function __() { this.constructor = d; }\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n\t};\n\tvar abstract_1 = __webpack_require__(2);\n\tvar es6_promise_1 = __webpack_require__(6);\n\tvar dbug = __webpack_require__(7);\n\tvar redisPool_1 = __webpack_require__(9);\n\tes6_promise_1.polyfill();\n\tvar debug = dbug('simple-url-cache-REDIS');\n\tvar RedisStorage = (function (_super) {\n\t    __extends(RedisStorage, _super);\n\t    function RedisStorage(_url, _storageConfig, _regexRules) {\n\t        var _this = this;\n\t        _super.call(this, _url, _regexRules);\n\t        this._url = _url;\n\t        this._storageConfig = _storageConfig;\n\t        this._regexRules = _regexRules;\n\t        this.isRedisOnline = function () {\n\t            return redisPool_1.RedisPool.isOnline();\n\t        };\n\t        this.isCached = function () {\n\t            return new Promise(function (resolve, reject) {\n\t                _this._conn.get(_this._url, function (err, data) {\n\t                    if (err) {\n\t                        debug('Error while querying is cached on redis: ', _this._url, err);\n\t                        reject(err);\n\t                    }\n\t                    else {\n\t                        var isCached = data !== null;\n\t                        resolve(isCached);\n\t                    }\n\t                });\n\t            });\n\t        };\n\t        this.removeUrl = function () {\n\t            debug('removing url cache: ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                _this._conn.del(_this._url, function (err, data) {\n\t                    if (err) {\n\t                        debug('Error while removing url: ', _this._url, err);\n\t                        reject(err);\n\t                    }\n\t                    resolve(true);\n\t                });\n\t            });\n\t        };\n\t        this.getUrl = function () {\n\t            debug('Retrieving url cache: ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                _this._conn.get(_this._url, function (err, data) {\n\t                    if (err) {\n\t                        debug('Error while retrieving url: ', _this._url, err);\n\t                        reject(err);\n\t                    }\n\t                    if (data === null) {\n\t                        debug('This url is not cached - and can\\'t be retrieved: ', _this._url);\n\t                        reject('This url is not cached: ' + _this._url);\n\t                    }\n\t                    else {\n\t                        resolve(data);\n\t                    }\n\t                });\n\t            });\n\t        };\n\t        this.cache = function (html, force) {\n\t            debug('Caching url ', _this._url);\n\t            return new Promise(function (resolve, reject) {\n\t                if (force === true) {\n\t                    _this._conn.set(_this._url, html, function (err, result) {\n\t                        if (err) {\n\t                            debug('Error while storing url in redis: ', _this._url, err);\n\t                            reject(err);\n\t                        }\n\t                        if (_this._currentCategory === 'maxAge') {\n\t                            _this._conn.expire(_this._url, _this._currentMaxAge, function (err) {\n\t                                if (err) {\n\t                                    debug('Error while setting ttl in redis: ', _this._url, err);\n\t                                    reject(err);\n\t                                }\n\t                                else {\n\t                                    debug('URL cached successfully with ttl = ', _this._currentMaxAge, _this._url);\n\t                                    resolve(true);\n\t                                }\n\t                            });\n\t                        }\n\t                        else {\n\t                            debug('URL cached sucessfully: ', _this._url);\n\t                            resolve(true);\n\t                        }\n\t                    });\n\t                }\n\t                else {\n\t                    _this.isCached().then(function (isCached) {\n\t                        if (isCached === true) {\n\t                            debug('This url is already cached - not storing it: ', _this._url);\n\t                            resolve(false);\n\t                        }\n\t                        else if (_this._currentCategory === 'never') {\n\t                            debug('Won\\'t cache the url - category is never.', _this._url);\n\t                            resolve(false);\n\t                        }\n\t                        else {\n\t                            _this._conn.set(_this._url, html, function (err, result) {\n\t                                if (err) {\n\t                                    debug('Error while storing url in redis: ', _this._url, err);\n\t                                    reject(err);\n\t                                }\n\t                                if (_this._currentCategory === 'maxAge') {\n\t                                    _this._conn.expire(_this._url, _this._currentMaxAge, function (err) {\n\t                                        if (err) {\n\t                                            debug('Error while setting ttl in redis: ', _this._url, err);\n\t                                            reject(err);\n\t                                        }\n\t                                        else {\n\t                                            debug('URL cached successfully with ttl = ', _this._currentMaxAge, _this._url);\n\t                                            resolve(true);\n\t                                        }\n\t                                    });\n\t                                }\n\t                                else {\n\t                                    debug('URL cached sucessfully: ', _this._url);\n\t                                    resolve(true);\n\t                                }\n\t                            });\n\t                        }\n\t                    });\n\t                }\n\t            });\n\t        };\n\t        this.destroy = function () {\n\t            redisPool_1.RedisPool.kill();\n\t        };\n\t        this._conn = redisPool_1.RedisPool.connect(this._storageConfig);\n\t    }\n\t    RedisStorage._redisPool = redisPool_1.RedisPool;\n\t    return RedisStorage;\n\t}(abstract_1.CacheCategory));\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = RedisStorage;\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\tvar redis = __webpack_require__(10);\n\tvar dbug = __webpack_require__(7);\n\tvar debug = dbug('simple-url-cache-REDIS');\n\tvar pool = null;\n\tvar RedisPool;\n\t(function (RedisPool) {\n\t    var _isOnline = false;\n\t    RedisPool.connect = function (config) {\n\t        if (pool === null) {\n\t            debug('This redis connection has never been instanciated before');\n\t            pool = redis.createClient(config);\n\t            pool.on('connect', function () {\n\t                _isOnline = true;\n\t                console.log('redis connected');\n\t            });\n\t            pool.on('error', function (e) {\n\t                console.error(e);\n\t                _isOnline = true;\n\t                pool = null;\n\t                throw new Error(e);\n\t            });\n\t            pool.on('end', function () {\n\t                pool = null;\n\t                _isOnline = false;\n\t                console.error('Connection closed');\n\t            });\n\t            pool.on('warning', function (msg) {\n\t                console.error('Warning called: ', msg);\n\t            });\n\t        }\n\t        return pool;\n\t    };\n\t    RedisPool.isOnline = function () {\n\t        return pool !== null && _isOnline === true;\n\t    };\n\t    RedisPool.kill = function () {\n\t        if (_isOnline === true) {\n\t            pool.end();\n\t        }\n\t    };\n\t})(RedisPool = exports.RedisPool || (exports.RedisPool = {}));\n\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"redis\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** dist/simple-cache.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 007dcb7c1d1ffbbe14a0\n **/","\"use strict\";\nvar fileStorage_1 = require('./fileStorage');\nexports.FileStorage = fileStorage_1.default;\nvar redisStorage_1 = require('./redisStorage');\nexports.RedisStorage = redisStorage_1.default;\nvar CacheEngine = (function () {\n    function CacheEngine(storageConfig, cacheRules) {\n        this.storageConfig = storageConfig;\n        this.cacheRules = cacheRules;\n    }\n    CacheEngine.prototype.url = function (url) {\n        switch (this.storageConfig.type) {\n            case 'file':\n                return new fileStorage_1.default(url, this.storageConfig, this.cacheRules);\n            case 'redis':\n                return new redisStorage_1.default(url, this.storageConfig, this.cacheRules);\n            default:\n                throw new Error('Unknown Storage config type value. Only file|redis allowed');\n        }\n    };\n    return CacheEngine;\n}());\nexports.CacheEngine = CacheEngine;\n;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./ts/cacheEngine.ts\n ** module id = 0\n ** module chunks = 0\n **/","\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar abstract_1 = require('./abstract');\nvar path = require('path');\nvar fs = require('fs');\nvar shell = require('shelljs');\nvar es6_promise_1 = require('es6-promise');\nvar dbug = require('debug');\nvar debug = dbug('simple-url-cache-FS');\nes6_promise_1.polyfill();\nvar FileStorage = (function (_super) {\n    __extends(FileStorage, _super);\n    function FileStorage(_url, _storageConfig, _regexRules) {\n        var _this = this;\n        _super.call(this, _url, _regexRules);\n        this._url = _url;\n        this._storageConfig = _storageConfig;\n        this._regexRules = _regexRules;\n        this.escape = function () {\n            var escaped = _this._url.replace(':', '%3A');\n            escaped = escaped.replace('.', '%2E'); //http://stackoverflow.com/questions/3856693/a-url-resource-that-is-a-dot-2e\n            escaped = escaped.replace('~', '%7E'); //http://www.w3schools.com/tags/ref_urlencode.asp\n            escaped = encodeURIComponent(escaped);\n            return escaped;\n        };\n        this.validate = function (str) {\n            if (str.length === 0) {\n                return false;\n            }\n            if (str.length > 255) {\n                return false;\n            }\n            if (typeof str === 'undefined') {\n                return false;\n            }\n            return true;\n        };\n        this.isCached = function () {\n            return new Promise(function (resolve, reject) {\n                if (fs.existsSync(_this._currentFilePath)) {\n                    if (_this._currentCategory === 'maxAge') {\n                        var stats = fs.statSync(_this._currentFilePath);\n                        var nowTimestamp = new Date().getTime();\n                        var modificationTime = stats.mtime.getTime();\n                        var expiration = modificationTime + _this._currentMaxAge * 1000;\n                        var diff = (nowTimestamp - expiration);\n                        _this.diff = diff;\n                        if (diff > 0) {\n                            //the file is expired, remove it, then return false;\n                            _this.removeUrl();\n                            debug('This url is expired.... removing the cache. ', _this._url);\n                            resolve(false);\n                        }\n                        else {\n                            debug('This url is cached.', _this._url);\n                            resolve(true);\n                        }\n                    }\n                    debug('This url is cached ', _this._url);\n                    resolve(true);\n                }\n                else {\n                    debug('This url is not cached ', _this._url);\n                    resolve(false);\n                }\n            });\n        };\n        this.removeUrl = function () {\n            debug('removing url cache: ', _this._url);\n            return new Promise(function (resolve, reject) {\n                try {\n                    fs.unlinkSync(_this._currentFilePath);\n                    resolve(true);\n                }\n                catch (e) {\n                    debug('Error while removing url: ', _this._url, e);\n                    reject(false);\n                }\n            });\n        };\n        this.getUrl = function () {\n            debug('Retrieving url cache: ', _this._url);\n            return new Promise(function (resolve, reject) {\n                _this.isCached().then(function (isCached) {\n                    if (!isCached) {\n                        reject('This url is not cached: ' + _this._url);\n                    }\n                    else {\n                        resolve(fs.readFileSync(_this._currentFilePath, 'utf8'));\n                    }\n                });\n            });\n        };\n        this.cache = function (html, force) {\n            debug('Caching url ', _this._url);\n            return new Promise(function (resolve, reject) {\n                if (!_this._validFile) {\n                    debug('FILE -> ' + 'invalid REJECTED', _this._url);\n                    reject('invalid URL');\n                    return;\n                }\n                else {\n                    if (force === true) {\n                        fs.writeFile(_this._currentFilePath, html, 'utf8', function (err) {\n                            if (err) {\n                                debug('Error while writing cache.', _this._url, err);\n                                reject('invalid URL');\n                            }\n                            else {\n                                debug('URL cached sucessfully: ', _this._url);\n                                resolve(true);\n                            }\n                        });\n                        return;\n                    }\n                    _this.isCached().then(function (isCached) {\n                        if (isCached) {\n                            resolve(false);\n                        }\n                        else {\n                            if (_this._currentCategory === 'never') {\n                                debug('Won\\'t cache the url - category is never.', _this._url);\n                                resolve(false);\n                                return;\n                            }\n                            fs.writeFile(_this._currentFilePath, html, 'utf8', function (err) {\n                                if (err) {\n                                    debug('Error while writing cache.', _this._url, err);\n                                    reject('invalid URL');\n                                }\n                                else {\n                                    debug('URL cached sucessfully: ', _this._url);\n                                    resolve(true);\n                                }\n                            });\n                        }\n                    });\n                }\n            });\n        };\n        this.destroy = function () { };\n        shell.mkdir('-p', this._storageConfig.dir);\n        var escaped = this.escape();\n        this._validFile = this.validate(escaped);\n        this._currentFilePath = path.join(this._storageConfig.dir, escaped);\n        debug('FileStorage instanciated with url: ' + this._url);\n        debug('_currentFilePath = ', this._currentFilePath);\n    }\n    return FileStorage;\n}(abstract_1.CacheCategory));\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = FileStorage;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./ts/fileStorage.ts\n ** module id = 1\n ** module chunks = 0\n **/","\"use strict\";\nvar CacheCategory = (function () {\n    function CacheCategory(currentUrl, _config) {\n        var _this = this;\n        this.currentUrl = currentUrl;\n        this._config = _config;\n        this.getRegexTest = function (u) {\n            return u.regex.test(_this.currentUrl);\n        };\n        //return always|never|maxAge|timestamp|default\n        this.getCacheCategory = function () {\n            var i;\n            for (i in _this._config.cacheNever) {\n                if (_this.getRegexTest(_this._config.cacheNever[i]) === true) {\n                    _this._currentCategory = 'never';\n                    return;\n                }\n            }\n            for (i in _this._config.cacheAlways) {\n                if (_this.getRegexTest(_this._config.cacheAlways[i]) === true) {\n                    _this._currentCategory = 'always';\n                    return;\n                }\n            }\n            for (i in _this._config.cacheMaxAge) {\n                if (_this.getRegexTest(_this._config.cacheMaxAge[i]) === true) {\n                    _this._currentCategory = 'maxAge';\n                    _this._currentMaxAge = _this._config.cacheMaxAge[i].maxAge;\n                    return;\n                }\n            }\n            _this._currentCategory = _this._config.default;\n            return;\n        };\n        this.getCacheCategory();\n    }\n    CacheCategory.prototype.getCategory = function () {\n        return this._currentCategory;\n    };\n    CacheCategory.prototype.getCurrentUrl = function () {\n        return this.currentUrl;\n    };\n    return CacheCategory;\n}());\nexports.CacheCategory = CacheCategory;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./ts/abstract.ts\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"shelljs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"shelljs\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"es6-promise\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"es6-promise\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"debug\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"debug\"\n ** module id = 7\n ** module chunks = 0\n **/","\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar abstract_1 = require('./abstract');\nvar es6_promise_1 = require('es6-promise');\nvar dbug = require('debug');\nvar redisPool_1 = require('./redisPool');\nes6_promise_1.polyfill();\nvar debug = dbug('simple-url-cache-REDIS');\nvar RedisStorage = (function (_super) {\n    __extends(RedisStorage, _super);\n    function RedisStorage(_url, _storageConfig, _regexRules) {\n        var _this = this;\n        _super.call(this, _url, _regexRules);\n        this._url = _url;\n        this._storageConfig = _storageConfig;\n        this._regexRules = _regexRules;\n        this.isRedisOnline = function () {\n            return redisPool_1.RedisPool.isOnline();\n        };\n        this.isCached = function () {\n            return new Promise(function (resolve, reject) {\n                _this._conn.get(_this._url, function (err, data) {\n                    if (err) {\n                        debug('Error while querying is cached on redis: ', _this._url, err);\n                        reject(err);\n                    }\n                    else {\n                        var isCached = data !== null;\n                        resolve(isCached);\n                    }\n                });\n            });\n        };\n        this.removeUrl = function () {\n            debug('removing url cache: ', _this._url);\n            return new Promise(function (resolve, reject) {\n                _this._conn.del(_this._url, function (err, data) {\n                    if (err) {\n                        debug('Error while removing url: ', _this._url, err);\n                        reject(err);\n                    }\n                    resolve(true);\n                });\n            });\n        };\n        this.getUrl = function () {\n            debug('Retrieving url cache: ', _this._url);\n            return new Promise(function (resolve, reject) {\n                _this._conn.get(_this._url, function (err, data) {\n                    if (err) {\n                        debug('Error while retrieving url: ', _this._url, err);\n                        reject(err);\n                    }\n                    if (data === null) {\n                        debug('This url is not cached - and can\\'t be retrieved: ', _this._url);\n                        reject('This url is not cached: ' + _this._url);\n                    }\n                    else {\n                        resolve(data);\n                    }\n                });\n            });\n        };\n        this.cache = function (html, force) {\n            debug('Caching url ', _this._url);\n            return new Promise(function (resolve, reject) {\n                if (force === true) {\n                    _this._conn.set(_this._url, html, function (err, result) {\n                        if (err) {\n                            debug('Error while storing url in redis: ', _this._url, err);\n                            reject(err);\n                        }\n                        if (_this._currentCategory === 'maxAge') {\n                            _this._conn.expire(_this._url, _this._currentMaxAge, function (err) {\n                                if (err) {\n                                    debug('Error while setting ttl in redis: ', _this._url, err);\n                                    reject(err);\n                                }\n                                else {\n                                    debug('URL cached successfully with ttl = ', _this._currentMaxAge, _this._url);\n                                    resolve(true);\n                                }\n                            });\n                        }\n                        else {\n                            debug('URL cached sucessfully: ', _this._url);\n                            resolve(true);\n                        }\n                    });\n                }\n                else {\n                    _this.isCached().then(function (isCached) {\n                        if (isCached === true) {\n                            debug('This url is already cached - not storing it: ', _this._url);\n                            resolve(false);\n                        }\n                        else if (_this._currentCategory === 'never') {\n                            debug('Won\\'t cache the url - category is never.', _this._url);\n                            resolve(false);\n                        }\n                        else {\n                            _this._conn.set(_this._url, html, function (err, result) {\n                                if (err) {\n                                    debug('Error while storing url in redis: ', _this._url, err);\n                                    reject(err);\n                                }\n                                if (_this._currentCategory === 'maxAge') {\n                                    _this._conn.expire(_this._url, _this._currentMaxAge, function (err) {\n                                        if (err) {\n                                            debug('Error while setting ttl in redis: ', _this._url, err);\n                                            reject(err);\n                                        }\n                                        else {\n                                            debug('URL cached successfully with ttl = ', _this._currentMaxAge, _this._url);\n                                            resolve(true);\n                                        }\n                                    });\n                                }\n                                else {\n                                    debug('URL cached sucessfully: ', _this._url);\n                                    resolve(true);\n                                }\n                            });\n                        }\n                    });\n                }\n            });\n        };\n        this.destroy = function () {\n            redisPool_1.RedisPool.kill();\n        };\n        this._conn = redisPool_1.RedisPool.connect(this._storageConfig);\n    }\n    RedisStorage._redisPool = redisPool_1.RedisPool;\n    return RedisStorage;\n}(abstract_1.CacheCategory));\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = RedisStorage;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./ts/redisStorage.ts\n ** module id = 8\n ** module chunks = 0\n **/","\"use strict\";\nvar redis = require('redis');\nvar dbug = require('debug');\nvar debug = dbug('simple-url-cache-REDIS');\nvar pool = null;\nvar RedisPool;\n(function (RedisPool) {\n    var _isOnline = false;\n    RedisPool.connect = function (config) {\n        if (pool === null) {\n            debug('This redis connection has never been instanciated before');\n            pool = redis.createClient(config);\n            pool.on('connect', function () {\n                _isOnline = true;\n                console.log('redis connected');\n            });\n            pool.on('error', function (e) {\n                console.error(e);\n                _isOnline = true;\n                pool = null;\n                throw new Error(e);\n            });\n            pool.on('end', function () {\n                pool = null;\n                _isOnline = false;\n                console.error('Connection closed');\n            });\n            pool.on('warning', function (msg) {\n                console.error('Warning called: ', msg);\n            });\n        }\n        return pool;\n    };\n    RedisPool.isOnline = function () {\n        return pool !== null && _isOnline === true;\n    };\n    RedisPool.kill = function () {\n        if (_isOnline === true) {\n            pool.end();\n        }\n    };\n})(RedisPool = exports.RedisPool || (exports.RedisPool = {}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./ts/redisPool.ts\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"redis\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"redis\"\n ** module id = 10\n ** module chunks = 0\n **/"],"sourceRoot":""}